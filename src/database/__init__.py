"""
–ü–∞–∫–µ—Ç database - —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞ –ú–ò–§–ò

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å:
1. –í–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π –æ–± –æ–±—â–µ–∂–∏—Ç–∏—è—Ö –ú–ò–§–ò
2. –°–µ—Å—Å–∏–æ–Ω–Ω–æ–π –±–∞–∑–æ–π –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
"""

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –∏–∑ –º–æ–¥—É–ª–µ–π
from .base import (
    MIFIDatabase,           # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –≤—Å–µ–º–∏ –ë–î
    mifi_database,          # –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    create_database,        # –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ë–î (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
    search_data,            # –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
    add_preloaded_data      # –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–ø—É—Å—Ç–∞—è)
)

from .models import (
    MIFIKnowledgeBase,      # –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è –æ –ú–ò–§–ò
    KnowledgeItem,          # –ú–æ–¥–µ–ª—å —ç–ª–µ–º–µ–Ω—Ç–∞ –∑–Ω–∞–Ω–∏–π
    Session,                # –ú–æ–¥–µ–ª—å —Å–µ—Å—Å–∏–∏ –¥–∏–∞–ª–æ–≥–∞
    Message,                # –ú–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è
    UserStats,              # –ú–æ–¥–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    create_test_session,    # –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    create_test_message     # –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
)

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º sessions_db –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤
from .sessions_db import SessionsDB, sessions_db

# –í–µ—Ä—Å–∏—è –ø–∞–∫–µ—Ç–∞
__version__ = "1.0.0"
__author__ = "–ö–æ–º–∞–Ω–¥–∞ –ú–ò–§–ò"
__description__ = "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —á–∞—Ç-–±–æ—Ç–∞ –ø–æ–º–æ—â–Ω–∏–∫–∞ –∫–æ–º–µ–Ω–¥–∞–Ω—Ç–∞"

# –°–ø–∏—Å–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –º–æ–¥—É–ª–µ–π
__all__ = [
    # –ò–∑ base.py
    "MIFIDatabase",
    "mifi_database", 
    "create_database",
    "search_data",
    "add_preloaded_data",
    
    # –ò–∑ models.py
    "MIFIKnowledgeBase",
    "KnowledgeItem",
    "Session",
    "Message", 
    "UserStats",
    "create_test_session",
    "create_test_message",
    
    # –ò–∑ sessions_db.py
    "SessionsDB",
    "sessions_db",
]

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
def init_database():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    try:
        # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π
        sessions_db.cleanup_old_sessions(days=7)
        
        # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        stats = mifi_database.get_database_stats()
        
        print("‚úÖ –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:")
        print(f"   üìö –ó–Ω–∞–Ω–∏–π: {stats['knowledge_base']['total_records']} –∑–∞–ø–∏—Å–µ–π")
        print(f"   üí¨ –°–µ—Å—Å–∏–π: {stats['sessions']['total_sessions']}")
        
        return True
    except Exception as e:
        print(f"‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î: {e}")
        return False

# –ó–∞–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –ø–∞–∫–µ—Ç–∞
if __name__ != "__main__":
    init_database()

# ==============================================
# –ü–†–û–°–¢–û–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï:
# ==============================================

if __name__ == "__main__":
    print(f"–ü–∞–∫–µ—Ç database v{__version__}")
    print(__description__)
    print("\n–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª–∞—Å—Å—ã:")
    
    for item in __all__:
        print(f"  ‚Ä¢ {item}")
    
    # –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    print("\nüß™ –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:")
    success = init_database()
    print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ –£—Å–ø–µ—à–Ω–æ' if success else '‚ùå –û—à–∏–±–∫–∞'}")
    
    # –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –ø–æ–∏—Å–∫–∞
    print("\nüîç –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –ø–æ–∏—Å–∫–∞:")
    results = search_data("–∞–¥—Ä–µ—Å", limit=2)
    print(f"–ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {len(results)}")
    if results:
        for i, r in enumerate(results, 1):
            print(f"  {i}. {r[1][:50]}...")
