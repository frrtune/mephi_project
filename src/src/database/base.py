
import sqlite3
import numpy as np
from sentence_transformers import SentenceTransformer

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
print("–ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–æ–≤...")
model = SentenceTransformer('all-MiniLM-L6-v2')

def create_database():
    """–°–æ–∑–¥–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–∞–±–ª–∏—Ü—ã"""
    conn = sqlite3.connect('mipti_dormitory_db.db')
    
    # –í–∫–ª—é—á–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
    conn.enable_load_extension(True)
    try:
        conn.load_extension("vector")
        conn.load_extension("vss0")
    except:
        print("–û—à–∏–±–∫–∞: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è SQLite VSS")
        return None
    
    # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤
    conn.execute('''
        CREATE TABLE IF NOT EXISTS dormitory_info (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            text TEXT NOT NULL,
            category TEXT,
            tags TEXT
        )
    ''')
    
    # –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –≤–µ–∫—Ç–æ—Ä–æ–≤
    conn.execute('''
        CREATE VIRTUAL TABLE IF NOT EXISTS dormitory_vectors USING vss0(
            vector(384)
        )
    ''')
    
    conn.commit()
    print("‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞!")
    return conn

def add_preloaded_data(conn):
    """–î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—â–µ–∂–∏—Ç–∏—è—Ö –ú–ò–§–ò"""
    dormitory_data = [
        {
            "text": "–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–æ–µ –æ–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ1 –ú–ò–§–ò —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: –ú–æ—Å–∫–≤–∞, —É–ª–∏—Ü–∞ –ú–æ—Å–∫–≤–æ—Ä–µ—á—å–µ, 2–∫1",
            "category": "–ê–¥—Ä–µ—Å–∞",
            "tags": "–æ–±—â–µ–∂–∏—Ç–∏–µ1, –∞–¥—Ä–µ—Å, –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
        },
        {
            "text": "–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ2 –ù–ò–Ø–£ –ú–ò–§–ò –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É: –ú–æ—Å–∫–≤–∞, —É–ª–∏—Ü–∞ –ú–æ—Å–∫–≤–æ—Ä–µ—á—å–µ, 2–∫2",
            "category": "–ê–¥—Ä–µ—Å–∞", 
            "tags": "–æ–±—â–µ–∂–∏—Ç–∏–µ2, –∞–¥—Ä–µ—Å, –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
        },
        {
            "text": "–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ3 —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: –ú–æ—Å–∫–≤–∞, —É–ª–∏—Ü–∞ –ú–æ—Å–∫–≤–æ—Ä–µ—á—å–µ, 19–∫3",
            "category": "–ê–¥—Ä–µ—Å–∞",
            "tags": "–æ–±—â–µ–∂–∏—Ç–∏–µ3, –∞–¥—Ä–µ—Å, –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
        },
        {
            "text": "–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ4 —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: –ú–æ—Å–∫–≤–∞, —É–ª–∏—Ü–∞ –ú–æ—Å–∫–≤–æ—Ä–µ—á—å–µ, 19–∫4",
            "category": "–ê–¥—Ä–µ—Å–∞",
            "tags": "–æ–±—â–µ–∂–∏—Ç–∏–µ3, –∞–¥—Ä–µ—Å, –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
        },
        {
            "text": "–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ5 —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: –ú–æ—Å–∫–≤–∞, —É–ª–∏—Ü–∞ –ö–æ—à–∫–∏–Ω–∞, 11",
            "category": "–ê–¥—Ä–µ—Å–∞",
            "tags": "–æ–±—â–µ–∂–∏—Ç–∏–µ3, –∞–¥—Ä–µ—Å, –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
        },
        {
            "text": "–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ7 —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: –ú–æ—Å–∫–≤–∞, —É–ª–∏—Ü–∞ –®–∫—É–ª–µ–≤–∞, 27",
            "category": "–ê–¥—Ä–µ—Å–∞",
            "tags": "–æ–±—â–µ–∂–∏—Ç–∏–µ3, –∞–¥—Ä–µ—Å, –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
        },
        {
            "text": "–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ8 —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: –ú–æ—Å–∫–≤–∞, –ü—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∏–π –ø—Ä-–∫—Ç., –¥. 8, –∫–æ—Ä–ø. 2",
            "category": "–ê–¥—Ä–µ—Å–∞",
            "tags": "–æ–±—â–µ–∂–∏—Ç–∏–µ3, –∞–¥—Ä–µ—Å, –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
        },
        {
            "text": "–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ9 —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: –ú–æ—Å–∫–≤–∞, –ü—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∏–π –ø—Ä-–∫—Ç., –¥. 8, –∫–æ—Ä–ø. 1",
            "category": "–ê–¥—Ä–µ—Å–∞",
            "tags": "–æ–±—â–µ–∂–∏—Ç–∏–µ3, –∞–¥—Ä–µ—Å, –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
        },
        {
            "text": "–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –≤ –æ–±—â–µ–∂–∏—Ç–∏–∏ –ú–ò–§–ò —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç 1200 –¥–æ 2500 —Ä—É–±–ª–µ–π –≤ –º–µ—Å—è—Ü –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∫–æ–º–Ω–∞—Ç—ã",
            "category": "–°—Ç–æ–∏–º–æ—Å—Ç—å",
            "tags": "—Ü–µ–Ω–∞, –æ–ø–ª–∞—Ç–∞, —Å—Ç–æ–∏–º–æ—Å—Ç—å, –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ"
        },
        {
            "text": "–í –æ–±—â–µ–∂–∏—Ç–∏—è—Ö –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –∫–æ–º–Ω–∞—Ç—ã –Ω–∞ 2-3 —á–µ–ª–æ–≤–µ–∫–∞ —Å –º–µ–±–µ–ª—å—é, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º –∏ —Å–∞–Ω—É–∑–ª–æ–º",
            "category": "–£—Å–ª–æ–≤–∏—è –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è",
            "tags": "–∫–æ–º–Ω–∞—Ç—ã, –º–µ–±–µ–ª—å, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, —É–¥–æ–±—Å—Ç–≤–∞"
        },
        {
            "text": "–î–ª—è –∑–∞—Å–µ–ª–µ–Ω–∏—è –≤ –æ–±—â–µ–∂–∏—Ç–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –∑–¥–æ—Ä–æ–≤—å—è, –ø–∞—Å–ø–æ—Ä—Ç, —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –∑–∞—è–≤–ª–µ–Ω–∏–µ",
            "category": "–î–æ–∫—É–º–µ–Ω—Ç—ã",
            "tags": "–∑–∞—Å–µ–ª–µ–Ω–∏–µ, –¥–æ–∫—É–º–µ–Ω—Ç—ã, —Å–ø—Ä–∞–≤–∫–∏, –∑–∞—è–≤–ª–µ–Ω–∏–µ"
        },
        {
            "text": "–ó–∞—è–≤–∫—É –Ω–∞ –æ–±—â–µ–∂–∏—Ç–∏–µ –º–æ–∂–Ω–æ –ø–æ–¥–∞—Ç—å —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏–ª–∏ –≤ –¥–µ–∫–∞–Ω–∞—Ç–µ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞",
            "category": "–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –∑–∞—Å–µ–ª–µ–Ω–∏—è",
            "tags": "–∑–∞—è–≤–∫–∞, –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç, –¥–µ–∫–∞–Ω–∞—Ç, –∑–∞—Å–µ–ª–µ–Ω–∏–µ"
        },
        {
            "text": "–í –æ–±—â–µ–∂–∏—Ç–∏—è—Ö –µ—Å—Ç—å –∫—É—Ö–Ω–∏ –Ω–∞ —ç—Ç–∞–∂–∞—Ö, –ø—Ä–∞—á–µ—á–Ω—ã–µ, –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è —Å–∞–º–æ–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –∑–∞–ª—ã",
            "category": "–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",
            "tags": "–∫—É—Ö–Ω—è, –ø—Ä–∞—á–µ—á–Ω–∞—è, —É—á–µ–±–∞, —Å–ø–æ—Ä—Ç, –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞"
        },
        {
            "text": "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç –≤ –æ–±—â–µ–∂–∏—Ç–∏—è—Ö –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é –¥–æ 100 –ú–±–∏—Ç/—Å",
            "category": "–£–¥–æ–±—Å—Ç–≤–∞",
            "tags": "–∏–Ω—Ç–µ—Ä–Ω–µ—Ç, wi-fi, —Å–≤—è–∑—å, –±–µ—Å–ø–ª–∞—Ç–Ω–æ"
        },
        {
            "text": "–û–±—â–µ–∂–∏—Ç–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ 10-15 –º–∏–Ω—É—Ç–∞—Ö —Ö–æ–¥—å–±—ã –æ—Ç —É—á–µ–±–Ω—ã—Ö –∫–æ—Ä–ø—É—Å–æ–≤ –ú–ò–§–ò",
            "category": "–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ",
            "tags": "—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, –¥–æ—Ä–æ–≥–∞, –∫–æ—Ä–ø—É—Å–∞, –º–µ—Ç—Ä–æ"
        },
        {
            "text": "–ë–ª–∏–∂–∞–π—à–∞—è —Å—Ç–∞–Ω—Ü–∏—è –º–µ—Ç—Ä–æ –∫ –æ–±—â–µ–∂–∏—Ç–∏—è–º - –ö–∞—à–∏—Ä—Å–∫–∞—è, –≤ 10 –º–∏–Ω—É—Ç–∞—Ö —Ö–æ–¥—å–±—ã",
            "category": "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç",
            "tags": "–º–µ—Ç—Ä–æ, –ö–∞—à–∏—Ä—Å–∫–∞—è, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –ø—Ä–æ–µ–∑–¥"
        },
        {
            "text": "–°—Ç—É–¥–µ–Ω—Ç—ã –ø–µ—Ä–≤—ã—Ö –∫—É—Ä—Å–æ–≤ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –º–µ—Å—Ç –≤ –æ–±—â–µ–∂–∏—Ç–∏–∏",
            "category": "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã",
            "tags": "–ø–µ—Ä–≤–æ–∫—É—Ä—Å–Ω–∏–∫–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ"
        },
        {
            "text": "–í –∫–∞–∂–¥–æ–º –æ–±—â–µ–∂–∏—Ç–∏–∏ –µ—Å—Ç—å –∫–æ–º–µ–Ω–¥–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç —Ä–µ—à–∞—Ç—å –±—ã—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
            "category": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è",
            "tags": "–∫–æ–º–µ–Ω–¥–∞–Ω—Ç, –≤–æ—Å–ø–∏—Ç–∞—Ç–µ–ª—å, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø–æ–º–æ—â—å"
        },
        {
            "text": "–î–ª—è –∏–Ω–æ–≥–æ—Ä–æ–¥–Ω–∏—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –º–µ—Å—Ç–∞ –≤ –æ–±—â–µ–∂–∏—Ç–∏–∏ –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ",
            "category": "–£—Å–ª–æ–≤–∏—è",
            "tags": "–∏–Ω–æ–≥–æ—Ä–æ–¥–Ω–∏–µ, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, –∑–∞—Å–µ–ª–µ–Ω–∏–µ"
        },
        {
            "text": "–í –æ–±—â–µ–∂–∏—Ç–∏—è—Ö —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ä–≥–∞–Ω–∏–∑—É—é—Ç –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –∏–Ω—Ç–µ—Ä–µ—Å—ã —Å—Ç—É–¥–µ–Ω—Ç–æ–≤",
            "category": "–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∞—è –∂–∏–∑–Ω—å",
            "tags": "—Å—Ç—É–¥—Å–æ–≤–µ—Ç, –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è"
        },
        {
            "text": "–†—è–¥–æ–º —Å –æ–±—â–µ–∂–∏—Ç–∏—è–º–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –º–∞–≥–∞–∑–∏–Ω—ã, —Å—Ç–æ–ª–æ–≤—ã–µ –∏ –∫–∞—Ñ–µ —Å–æ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–º–∏ —Å–∫–∏–¥–∫–∞–º–∏",
            "category": "–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞",
            "tags": "–º–∞–≥–∞–∑–∏–Ω—ã, –ø–∏—Ç–∞–Ω–∏–µ, —Å—Ç–æ–ª–æ–≤—ã–µ, —Å–∫–∏–¥–∫–∏"
        },
        {
            "text": "–ó–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –≤ –æ–±—â–µ–∂–∏—Ç–∏–∏ –º–æ–≥—É—Ç –≤—ã—Å–µ–ª–∏—Ç—å/–æ—Ç—á–∏—Å–ª–∏—Ç—å",
            "category": "–ü—Ä–∞–≤–∏–ª–∞",
            "tags": "–Ω–∞—Ä—É—à–µ–Ω–∏—è, –≤—ã—Å–µ–ª–µ–Ω–∏–µ, –ø—Ä–∞–≤–∏–ª–∞, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞"
        },
        {
            "text": "–î–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –∑–¥–æ—Ä–æ–≤—å—è —Å–æ–∑–¥–∞–Ω—ã —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –≤ –æ–±—â–µ–∂–∏—Ç–∏—è—Ö",
            "category": "–û—Å–æ–±—ã–µ —É—Å–ª–æ–≤–∏—è",
            "tags": "–û–í–ó, –¥–æ—Å—Ç—É–ø–Ω–∞—è —Å—Ä–µ–¥–∞, –æ—Å–æ–±—ã–µ —É—Å–ª–æ–≤–∏—è"
        }
    ]
    
    print("üìö –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—â–µ–∂–∏—Ç–∏—è—Ö –ú–ò–§–ò...")
    
    for data in dormitory_data:
        # –°–æ–∑–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
        vector = model.encode([data["text"]])[0].tolist()
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
        cursor = conn.cursor()
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç
        cursor.execute(
            'INSERT INTO dormitory_info (text, category, tags) VALUES (?, ?, ?)',
            (data["text"], data["category"], data["tags"])
        )
        text_id = cursor.lastrowid
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–µ–∫—Ç–æ—Ä
        conn.execute(
            'INSERT INTO dormitory_vectors(rowid, vector) VALUES (?, ?)',
            (text_id, vector)
        )
    
    conn.commit()
    print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ {len(dormitory_data)} –∑–∞–ø–∏—Å–µ–π –æ–± –æ–±—â–µ–∂–∏—Ç–∏—è—Ö –ú–ò–§–ò!")

def add_manual_data(conn, text, category="–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", tags="–æ–±—â–µ–∂–∏—Ç–∏–µ, –ú–ò–§–ò"):
    """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –±–∞–∑—É"""
    # –°–æ–∑–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
    vector = model.encode([text])[0].tolist()
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
    cursor = conn.cursor()
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—Å—Ç
    cursor.execute(
        'INSERT INTO dormitory_info (text, category, tags) VALUES (?, ?, ?)',
        (text, category, tags)
    )
    text_id = cursor.lastrowid
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–µ–∫—Ç–æ—Ä
    conn.execute(
        'INSERT INTO dormitory_vectors(rowid, vector) VALUES (?, ?)',
        (text_id, vector)
    )
    
    conn.commit()
    return text_id

def search_data(conn, search_text, limit=5):
    """–ü–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"""
    # –°–æ–∑–¥–∞–µ–º –≤–µ–∫—Ç–æ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞
    search_vector = model.encode([search_text])[0].tolist()
    
    # –ò—â–µ–º –ø–æ—Ö–æ–∂–∏–µ
    cursor = conn.cursor()
    cursor.execute('''
        SELECT 
            t.id, 
            t.text, 
            t.category,
            t.tags,
            vss_distance AS similarity
        FROM dormitory_vectors 
        JOIN dormitory_info t ON t.id = dormitory_vectors.rowid
        WHERE vss_search(vector, ?)
        LIMIT ?
    ''', (search_vector, limit))
    
    results = cursor.fetchall()
    return results

def view_all_data(conn):
    """–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"""
    cursor = conn.cursor()
    cursor.execute('''
        SELECT id, text, category, tags 
        FROM dormitory_info 
        ORDER BY category, id
    ''')
    
    all_data = cursor.fetchall()
    return all_data
