# tests/evaluation_pipeline_full.py
from src.llm.agents.consultant_agent import ConsultantAgent
from src.llm.agents.psychologist_agent import PsychologistAgent
from src.llm.agents.tester_agent import TesterAgent

# === –í–°–ï –í–û–ü–†–û–°–´ –ò–ó –¢–ï–°–¢–û–í + –†–ê–°–®–ò–†–ï–ù–ò–ï ===

CONSULTANT_QUESTIONS = [
    # –û—Ä–∏–≥–∏–Ω–∞–ª –∏–∑ test_consultant.py
    "–ê–¥—Ä–µ—Å –æ–±—â–µ–∂–∏—Ç–∏—è?",
    "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ?",
    "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã –¥–ª—è –∑–∞—Å–µ–ª–µ–Ω–∏—è?",
    "–ï—Å—Ç—å –ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –≤ –æ–±—â–µ–∂–∏—Ç–∏–∏?",
    "–ö–∞–∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å –±–æ—Ä—â?",
    "–ö–æ–≥–¥–∞ –∫–æ–º–µ–Ω–¥–∞–Ω—Ç—Å–∫–∏–π —á–∞—Å?",
    "–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å—Ç–æ–ª–æ–≤–∞—è?",
    "–ö–∞–∫ –≤—ã–∑–≤–∞—Ç—å —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞?",
    "–ö–∞–∫?",
    "–ì–¥–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Å–ø—Ä–∞–≤–∫–∏ –æ –∑–¥–æ—Ä–æ–≤—å–µ?",

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã (–∞–¥—Ä–µ—Å–∞, –∫–æ–Ω—Ç–∞–∫—Ç—ã, –ø—Ä–∞–≤–∏–ª–∞)
    "–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∫–æ–º–µ–Ω–¥–∞–Ω—Ç–∞ –∫–æ—Ä–ø—É—Å–∞ 1?",
    "–ú–æ–∂–Ω–æ –ª–∏ –¥–µ—Ä–∂–∞—Ç—å –∫–æ—à–∫—É –≤ –æ–±—â–µ–∂–∏—Ç–∏–∏?",
    "–ö–∞–∫ –æ–ø–ª–∞—Ç–∏—Ç—å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏–µ?",
    "–ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Å–ª–æ–º–∞–ª—Å—è –∑–∞–º–æ–∫ –≤ –∫–æ–º–Ω–∞—Ç–µ?",
    "–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç—Ä–µ–Ω–∞–∂—ë—Ä–Ω—ã–π –∑–∞–ª?",
    "–ú–æ–∂–Ω–æ –ª–∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –¥—Ä—É–≥–∞ –Ω–∞ –Ω–æ—á—å?",
    "–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –≤ –∫–æ–º–Ω–∞—Ç–µ?",
    "–ï—Å—Ç—å –ª–∏ —Å—Ç–∏—Ä–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –≤ –∫–æ—Ä–ø—É—Å–µ 9?",
    "–ö–æ–≥–¥–∞ –æ–±–µ–¥ —É –∫–æ–º–µ–Ω–¥–∞–Ω—Ç–æ–≤?",
    "–ù—É–∂–Ω–∞ –ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏ –∑–∞—Å–µ–ª–µ–Ω–∏–∏?",
    "–ú–æ–∂–Ω–æ –ª–∏ –∫—É—Ä–∏—Ç—å –Ω–∞ –±–∞–ª–∫–æ–Ω–µ?",
    "–ì–¥–µ —Å–¥–∞–≤–∞—Ç—å –∫—Ä–æ–≤—å –∫–∞–∫ –¥–æ–Ω–æ—Ä?",
    "–ö–∞–∫–∏–µ –æ–±—â–µ–∂–∏—Ç–∏—è –∫–≤–∞—Ä—Ç–∏—Ä–Ω–æ–≥–æ —Ç–∏–ø–∞?",
    "–ï—Å—Ç—å –ª–∏ —á–∏—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ª—ã?",
    "–ö—É–¥–∞ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ —Å —Å–æ—Å–µ–¥–æ–º?",
    "–ö–∞–∫–∏–µ –≥–æ—Ä—è—á–∏–µ –ª–∏–Ω–∏–∏ –µ—Å—Ç—å –≤ –ú–ò–§–ò?",
    "–ú–æ–∂–Ω–æ –ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –≤–µ–ª–æ—Å–∏–ø–µ–¥ –≤ –∫–æ—Ä–∏–¥–æ—Ä–µ?",
    "–ö–∞–∫–∏–µ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –µ—Å—Ç—å?",
    "–ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ –ø—Å–∏—Ö–æ–ª–æ–≥—É?",
    "–ê –≤ –∫–æ—Ä–ø—É—Å–µ 5 –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç?",
]

PSYCHOLOGIST_QUESTIONS = [
    # –û—Ä–∏–≥–∏–Ω–∞–ª –∏–∑ test_psychologist.py
    "–£ –º–µ–Ω—è —Å—Ç—Ä–µ—Å—Å –∏ –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–æ",
    "–Ø —á—É–≤—Å—Ç–≤—É—é —Ç—Ä–µ–≤–æ–≥—É –ø–µ—Ä–µ–¥ —ç–∫–∑–∞–º–µ–Ω–∞–º–∏",
    "–ú–Ω–µ –≥—Ä—É—Å—Ç–Ω–æ –∏ –æ–¥–∏–Ω–æ–∫–æ",
    "–Ø –Ω–µ —Å–ø—Ä–∞–≤–ª—è—é—Å—å —Å —É—á—ë–±–æ–π",
    "–•–æ—á—É –ø–æ–∫–æ–Ω—á–∏—Ç—å —Å–æ –≤—Å–µ–º",
    "–ö–∞–∫ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–µ–π?",
    "–ü–æ–º–æ–≥–∏—Ç–µ, —è –Ω–µ –º–æ–≥—É —É—Å–Ω—É—Ç—å –æ—Ç —Ç—Ä–µ–≤–æ–≥–∏",
    "–•–æ—á—É —Å–≤–∞–ø–Ω—É—Ç—å hemi 5.7 –≤ –≤–æ–ª–≥—É",
    "–ü—Ä–æ—Å—Ç–æ —Ö–æ—á–µ—Ç—Å—è –≤—ã–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è",
    "–ö–∞–∫ —É–ª—É—á—à–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?",

    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
    "–ú–µ–Ω—è –∏–∑–¥–µ–≤–∞—é—Çc—è –æ–¥–Ω–æ–≥—Ä—É–ø–ø–Ω–∏–∫–∏",
    "–Ø –±–æ—é—Å—å –≤—ã—Å—Ç—É–ø–∞—Ç—å –ø–µ—Ä–µ–¥ –∞—É–¥–∏—Ç–æ—Ä–∏–µ–π",
    "–ß—É–≤—Å—Ç–≤—É—é –≤—ã–≥–æ—Ä–∞–Ω–∏–µ",
    "–ù–µ –º–æ–≥—É –Ω–∞–π—Ç–∏ –º–æ—Ç–∏–≤–∞—Ü–∏—é —É—á–∏—Ç—å—Å—è",
    "–£ –º–µ–Ω—è –ø–∞–Ω–∏—á–µ—Å–∫–∏–µ –∞—Ç–∞–∫–∏",
    "–ë–æ—é—Å—å, —á—Ç–æ –º–µ–Ω—è –æ—Ç—á–∏—Å–ª—è—Ç",
    "–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —è –Ω–∏–∫–æ–º—É –Ω–µ –Ω—É–∂–µ–Ω",
    "–ö–∞–∫ –Ω–∞–ª–∞–¥–∏—Ç—å —Å–æ–Ω?",
    "–Ø –≤ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ —Å —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏ –∏–∑-–∑–∞ —É—á—ë–±—ã",
    "–ü–æ—Å—Ç–æ—è–Ω–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—é —Å–µ–±—è —Å –¥—Ä—É–≥–∏–º–∏",
    "–ù–µ –∑–Ω–∞—é, –∫–µ–º —Ö–æ—á—É —Å—Ç–∞—Ç—å",
    "–ú–Ω–µ —Ç—è–∂–µ–ª–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –ú–æ—Å–∫–≤–µ",
    "–•–æ—á—É –±—Ä–æ—Å–∏—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç",
    "–ö–∞–∫ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å –∑–∞–≤–∏—Å—Ç—å—é?",
    "–ú–Ω–µ —Å—Ç—ã–¥–Ω–æ –ø—Ä–æ—Å–∏—Ç—å –æ –ø–æ–º–æ—â–∏",
    "–£ –º–µ–Ω—è –Ω–∞–≤—è–∑—á–∏–≤—ã–µ –º—ã—Å–ª–∏",
    "–ö–∞–∫ –Ω–∞–ª–∞–¥–∏—Ç—å –æ—Ç–Ω–æ—à–µ–Ω–∏—è –≤ –ø–∞—Ä–µ?",
    "–Ø –±–æ—é—Å—å –±—É–¥—É—â–µ–≥–æ",
    "–ú–µ–Ω—è –ø—Ä–µ—Å–ª–µ–¥—É—é—Ç –Ω–µ—É–¥–∞—á–∏",
    "–ü—Ä–æ—Å—Ç–æ —Å–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å",
]

# === –ó–ê–ü–£–°–ö –û–¶–ï–ù–ö–ò ===

def run_full_evaluation():
    consultant = ConsultantAgent()
    psychologist = PsychologistAgent()
    tester = TesterAgent()

    results = []

    print("üß† –û—Ü–µ–Ω–∫–∞ ConsultantAgent –Ω–∞ {} –≤–æ–ø—Ä–æ—Å–∞—Ö...\n".format(len(CONSULTANT_QUESTIONS)))
    for q in CONSULTANT_QUESTIONS:
        try:
            resp = consultant.answer(q)
            eval_res = tester.assess_response(q, resp)
            score = eval_res["score"] or 0
            results.append(("consultant", q, resp, score, eval_res["explanation"]))
            print(f"‚úÖ [–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç] {score}/5 | {q[:50]}...")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å–µ: {q} ‚Üí {e}")
            results.append(("consultant", q, "", 0, "–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"))

    print("\n‚ù§Ô∏è –û—Ü–µ–Ω–∫–∞ PsychologistAgent –Ω–∞ {} –≤–æ–ø—Ä–æ—Å–∞—Ö...\n".format(len(PSYCHOLOGIST_QUESTIONS)))
    for q in PSYCHOLOGIST_QUESTIONS:
        try:
            resp = psychologist.answer(q)
            eval_res = tester.assess_response(q, resp)
            score = eval_res["score"] or 0
            results.append(("psychologist", q, resp, score, eval_res["explanation"]))
            print(f"‚úÖ [–ü—Å–∏—Ö–æ–ª–æ–≥] {score}/5 | {q[:50]}...")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å–µ: {q} ‚Üí {e}")
            results.append(("psychologist", q, "", 0, "–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"))

    # === –ò–¢–û–ì–ò ===
    consult_scores = [r[3] for r in results if r[0] == "consultant"]
    psych_scores = [r[3] for r in results if r[0] == "psychologist"]

    print("\n" + "="*60)
    print("üìä –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–Å–¢")
    print(f"–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç:   {len(consult_scores)} –≤–æ–ø—Ä–æ—Å–æ–≤ | –°—Ä–µ–¥–Ω–µ–µ: {sum(consult_scores)/len(consult_scores):.2f}/5")
    print(f"–ü—Å–∏—Ö–æ–ª–æ–≥:      {len(psych_scores)} –≤–æ–ø—Ä–æ—Å–æ–≤ | –°—Ä–µ–¥–Ω–µ–µ: {sum(psych_scores)/len(psych_scores):.2f}/5")

    # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª
    with open("evaluation_full_report.txt", "w", encoding="utf-8") as f:
        for agent, q, ans, score, expl in results:
            f.write(f"[{agent.upper()}] –û–¶–ï–ù–ö–ê: {score}/5\n")
            f.write(f"–í–æ–ø—Ä–æ—Å: {q}\n")
            f.write(f"–û—Ç–≤–µ—Ç: {ans}\n")
            f.write(f"–û–±—ä—è—Å–Ω–µ–Ω–∏–µ: {expl}\n")
            f.write("-" * 80 + "\n")

    print("\nüìÑ –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤: evaluation_full_report.txt")

if __name__ == "__main__":
    run_full_evaluation()
